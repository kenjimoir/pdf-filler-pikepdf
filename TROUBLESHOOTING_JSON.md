# Render.com 環境変数設定 - トラブルシューティング

## ❌ 現在のエラー

```
Error: Invalid GOOGLE_CREDENTIALS_JSON: Unexpected token b in JSON at position 2
```

これは、JSONのパースエラーです。環境変数の値が正しく設定されていない可能性があります。

---

## 🔍 原因

以下のいずれかが原因の可能性があります：

1. **JSONの一部が欠けている** - コピー&ペースト時に一部が欠けた
2. **余分な文字が含まれている** - JSONの前後に余分な文字がある
3. **改行の処理** - 改行が正しく処理されていない
4. **エスケープの問題** - 特殊文字が正しくエスケープされていない

---

## ✅ 解決方法

### 方法1: JSONを再設定（推奨）

#### ステップ1: JSONファイルを確認

1. Google Cloud ConsoleからダウンロードしたJSONファイルを開く
2. **ファイル全体を確認**して、正しいJSON形式であることを確認
3. JSONは `{` で始まり `}` で終わる必要があります

#### ステップ2: Render.comで再設定

1. Render.comのサービスページ → **"Environment"** タブ
2. **"Edit"** ボタンをクリック
3. `GOOGLE_CREDENTIALS_JSON` の値を確認
4. **一度削除して再追加**してみる

**重要なポイント**:
- JSON全体を**1行で貼り付け**することを推奨
- または、**改行を含むJSONでもOK**（Render.comが自動処理）
- 値の前後に**余分なスペースがない**ことを確認

#### ステップ3: JSONの形式を確認

正しいJSONの例：
```json
{"type":"service_account","project_id":"...","private_key_id":"...","private_key":"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n","client_email":"...@....iam.gserviceaccount.com",...}
```

**確認ポイント**:
- `{` で始まっているか
- `}` で終わっているか
- 全体が1つのJSONオブジェクトになっているか

### 方法2: 環境変数の値を確認

Render.comの環境変数画面で：
1. **"Edit"** ボタンをクリック
2. `GOOGLE_CREDENTIALS_JSON` の値の**目のアイコン**をクリックして値を確認
3. JSONが正しく設定されているか確認

### 方法3: テスト用の簡単なJSONで確認

まず、簡単なJSONで動作確認：

```json
{"test":"value"}
```

これでパースエラーが出ないか確認してください。

---

## 🔧 コードの改善

エラーメッセージを改善して、より詳細な情報を表示するようにしました。

再デプロイ後、ログで以下の情報が表示されます：
- JSONの最初の100文字
- JSONの長さ
- 詳細なエラーメッセージ

これで、問題の原因を特定しやすくなります。

---

## 📝 チェックリスト

- [ ] JSONファイルが正しくダウンロードされている
- [ ] JSONファイル全体がコピーされている（一部が欠けていない）
- [ ] Render.comの環境変数に正しく貼り付けられている
- [ ] 値の前後に余分なスペースがない
- [ ] JSONが `{` で始まり `}` で終わっている

---

## 🚀 次のステップ

1. **コードを更新**（エラーメッセージ改善）
2. **GitHubにプッシュ**
3. **Render.comで自動再デプロイ**
4. **ログで詳細なエラー情報を確認**
5. **環境変数を再設定**（必要に応じて）

---

コードを更新して、GitHubにプッシュしてください。その後、Render.comのログでより詳細なエラー情報を確認できます。

